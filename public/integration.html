<html>
    <head>
        <style>
            html { font-size: 14px; font-family: Verdana, Geneva, Tahoma, sans-serif; }
            input[type="text"] { width: 100%; padding: .5em; margin-bottom: 1em; }
            iframe { width: 100%; min-height: 300px; border: 1px solid #ccc; }
            h2 { font-size: 1em; }
        </style>
        <title>-- Integrated --</title>
    </head>
    <body>
        <h2>Select payment method</h2>
        <select id="metadata"></select>
        <h2>Iframe - integrating GPT Capturing UI</h2>
        <iframe src="#" style="border:1px solid red;"></iframe>

        <h2>External Submit</h2>
        <input type="button" value="Submit">

        <h2>Output</h2>
        <div id="output">Will be populated after GPT Capturing is finished.</div>



        <h2>Payment method metadata Url</h2>
        <input type="text" name="url-metadata" class="url-metadata" disabled="disabled">

        <h2>Payment menthod UI Url</h2>
        <input type="text" name="url-metadata_ui" class="url-metadata_ui" disabled="disabled">


        <script type="text/javascript" src="/js/jquery.min.js"></script>
        <script type="text/javascript">
          var metadataUrl = 'https://courageous-dragonfly.gomix.me/metadata/';
          //var metadataUiUrl = 'https://courageous-dragonfly.gomix.me/metadata-ui/';
          var metadata;
          jQuery(function($){
            $('select').on('change', function() {
              var selected = $('option:selected', this).val();
              $('input.url-metadata').val(metadataUrl + selected);
              $('input.url-metadata_ui').val(metadataUrl + selected + "/ui");
              $('iframe').attr('src', metadataUrl + selected + "/ui");
            });

            $('input[type="button"]').on('click', function() {
              $('iframe').get(0).contentWindow.postMessage('submit', '*');
            });

            $.ajax({ url:
              metadataUrl,
              type: "get",
              headers: {
                "Accept": "text/json; charset=utf-8",
                "Content-Type": "text/json; charset=utf-8"
              }
            }).done(function(data) {
              var select = $('select');
              $('option', select).remove();
              metadata = data;
              //console.log(metadata);
              metadata.forEach(function(m) {
                $('<option value="' + m._id + '">' + m.config.display_name + '</option>').appendTo(select);
              });
              $('select').change();
            });


            // Create IE + others compatible event handler
            var eventMethod = window.addEventListener ? "addEventListener" : "attachEvent";
            var eventer = window[eventMethod];
            var messageEvent = eventMethod == "attachEvent" ? "onmessage" : "message";

            // Listen to message from child window
            eventer(messageEvent,function(e) {
              $('#output').text(JSON.stringify(e.data));
            },false);

          });
        </script>
    </body>
</html>
